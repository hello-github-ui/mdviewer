"use strict";(self.webpackChunkmdviewer=self.webpackChunkmdviewer||[]).push([[687],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var r=i(96540);const d={},t=r.createContext(d);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},57368:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa","title":"06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa","description":"1\u3001\u521b\u5efa\u5fae\u670d\u52a1\u6a21\u5757","source":"@site/docs/\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa.md","sourceDirName":"\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09","slug":"/\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa","permalink":"/mdviewer/docs/\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa","draft":false,"unlisted":false,"editUrl":"https://github.com/hello-github-ui/mdviewer/edit/master/docs/\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa.md","tags":[{"inline":true,"label":"\u5c1a\u7845\u8c37","permalink":"/mdviewer/docs/tags/\u5c1a\u7845\u8c37"}],"version":"current","sidebarPosition":6,"frontMatter":{"id":"06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa","title":"06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa","tags":["\u5c1a\u7845\u8c37"]},"sidebar":"tutorialSidebar","previous":{"title":"05-\u6587\u4ef6\u4e0a\u4f20\u6d4b\u8bd5","permalink":"/mdviewer/docs/\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/05-\u6587\u4ef6\u4e0a\u4f20\u6d4b\u8bd5"},"next":{"title":"07-\u524d\u7aef\u6574\u5408\u89c6\u9891\u4e0a\u4f20","permalink":"/mdviewer/docs/\u8c37\u7c92\u5b66\u9662\u5728\u7ebf\u6559\u80b2\u9879\u76ee/day09/07-\u524d\u7aef\u6574\u5408\u89c6\u9891\u4e0a\u4f20"}}');var d=i(74848),t=i(28453);const o={id:"06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa",title:"06-\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1\u7684\u521b\u5efa",tags:["\u5c1a\u7845\u8c37"]},a="\u4e00\u3001\u521b\u5efa\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1",l={},c=[{value:"1\u3001\u521b\u5efa\u5fae\u670d\u52a1\u6a21\u5757",id:"1\u521b\u5efa\u5fae\u670d\u52a1\u6a21\u5757",level:2},{value:"3\u3001application.properties",id:"3applicationproperties",level:2},{value:"4\u3001logback.xml",id:"4logbackxml",level:2},{value:"5\u3001\u542f\u52a8\u7c7b",id:"5\u542f\u52a8\u7c7b",level:2},{value:"1\u3001\u521b\u5efa\u5e38\u91cf\u7c7b",id:"1\u521b\u5efa\u5e38\u91cf\u7c7b",level:2},{value:"2\u3001\u590d\u5236\u5de5\u5177\u7c7b\u5230\u9879\u76ee\u4e2d",id:"2\u590d\u5236\u5de5\u5177\u7c7b\u5230\u9879\u76ee\u4e2d",level:2},{value:"3\u3001\u914d\u7f6eswagger",id:"3\u914d\u7f6eswagger",level:2},{value:"4\u3001\u521b\u5efaservice",id:"4\u521b\u5efaservice",level:2},{value:"5\u3001\u521b\u5efacontroller",id:"5\u521b\u5efacontroller",level:2},{value:"6\u3001\u542f\u52a8\u540e\u7aefvod\u5fae\u670d\u52a1",id:"6\u542f\u52a8\u540e\u7aefvod\u5fae\u670d\u52a1",level:2},{value:"7\u3001swagger\u6d4b\u8bd5",id:"7swagger\u6d4b\u8bd5",level:2}];function s(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"\u4e00\u521b\u5efa\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1",children:(0,d.jsx)(n.strong,{children:"\u4e00\u3001\u521b\u5efa\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1"})})}),"\n",(0,d.jsx)(n.h2,{id:"1\u521b\u5efa\u5fae\u670d\u52a1\u6a21\u5757",children:"1\u3001\u521b\u5efa\u5fae\u670d\u52a1\u6a21\u5757"}),"\n",(0,d.jsx)(n.p,{children:"Artifact\uff1aservice-vod"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"2\u3001pom"})}),"\n",(0,d.jsxs)(n.p,{children:["**\uff081\uff09**",(0,d.jsx)(n.strong,{children:"service-vod\u4e2d\u5f15\u5165\u4f9d\u8d56"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"<dependencies>\n    <dependency>\n        <groupId>com.aliyun</groupId>\n        <artifactId>aliyun-java-sdk-core</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.aliyun.oss</groupId>\n        <artifactId>aliyun-sdk-oss</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.aliyun</groupId>\n        <artifactId>aliyun-java-sdk-vod</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.aliyun</groupId>\n        <artifactId>aliyun-sdk-vod-upload</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.alibaba</groupId>\n        <artifactId>fastjson</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.json</groupId>\n        <artifactId>json</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>com.google.code.gson</groupId>\n        <artifactId>gson</artifactId>\n    </dependency>\n\n    <dependency>\n        <groupId>joda-time</groupId>\n        <artifactId>joda-time</artifactId>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,d.jsx)(n.h2,{id:"3applicationproperties",children:"3\u3001application.properties"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"# \u670d\u52a1\u7aef\u53e3\nserver.port=8003\n# \u670d\u52a1\u540d\nspring.application.name=service-vod\n\n# \u73af\u5883\u8bbe\u7f6e\uff1adev\u3001test\u3001prod\nspring.profiles.active=dev\n\n#\u963f\u91cc\u4e91 vod\n#\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u5730\u5740\u4e0d\u540c\naliyun.vod.file.keyid=your accessKeyId\naliyun.vod.file.keysecret=your accessKeySecret\n\n# \u6700\u5927\u4e0a\u4f20\u5355\u4e2a\u6587\u4ef6\u5927\u5c0f\uff1a\u9ed8\u8ba41M\nspring.servlet.multipart.max-file-size=1024MB\n# \u6700\u5927\u7f6e\u603b\u4e0a\u4f20\u7684\u6570\u636e\u5927\u5c0f \uff1a\u9ed8\u8ba410M\nspring.servlet.multipart.max-request-size=1024MB\n"})}),"\n",(0,d.jsx)(n.h2,{id:"4logbackxml",children:"4\u3001logback.xml"}),"\n",(0,d.jsx)(n.h2,{id:"5\u542f\u52a8\u7c7b",children:"5\u3001\u542f\u52a8\u7c7b"}),"\n",(0,d.jsx)(n.p,{children:"VodApplication.java"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'package com.guli.vod;\n\n@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)\n@ComponentScan(basePackages={"com.atguigu"})\npublic class VodApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(VodApplication.class, args);\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h1,{id:"\u4e8c\u6574\u5408\u963f\u91cc\u4e91vod\u5b9e\u73b0\u89c6\u9891\u4e0a\u4f20",children:"\u4e8c\u3001\u6574\u5408\u963f\u91cc\u4e91vod\u5b9e\u73b0\u89c6\u9891\u4e0a\u4f20"}),"\n",(0,d.jsx)(n.h2,{id:"1\u521b\u5efa\u5e38\u91cf\u7c7b",children:"1\u3001\u521b\u5efa\u5e38\u91cf\u7c7b"}),"\n",(0,d.jsx)(n.p,{children:"ConstantPropertiesUtil.java"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'package com.guli.vod.util;\n\n@Component\n//@PropertySource("classpath:application.properties")\npublic class ConstantPropertiesUtil implements InitializingBean {\n\n    @Value("${aliyun.vod.file.keyid}")\n    private String keyId;\n\n    @Value("${aliyun.vod.file.keysecret}")\n    private String keySecret;\n\n    public static String ACCESS_KEY_ID;\n    public static String ACCESS_KEY_SECRET;\n\n    @Override\n    public void afterPropertiesSet() throws Exception {\n        ACCESS_KEY_ID = keyId;\n        ACCESS_KEY_SECRET = keySecret;\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"2\u590d\u5236\u5de5\u5177\u7c7b\u5230\u9879\u76ee\u4e2d",children:"2\u3001\u590d\u5236\u5de5\u5177\u7c7b\u5230\u9879\u76ee\u4e2d"}),"\n",(0,d.jsx)(n.p,{children:"AliyunVodSDKUtils.java"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'package com.guli.vod.util;\n\npublic class AliyunVodSDKUtils {\n    public static DefaultAcsClient initVodClient(String accessKeyId, String accessKeySecret) throws ClientException {\n        String regionId = "cn-shanghai";  // \u70b9\u64ad\u670d\u52a1\u63a5\u5165\u533a\u57df\n        DefaultProfile profile = DefaultProfile.getProfile(regionId, accessKeyId, accessKeySecret);\n        DefaultAcsClient client = new DefaultAcsClient(profile);\n        return client;\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"3\u914d\u7f6eswagger",children:"3\u3001\u914d\u7f6eswagger"}),"\n",(0,d.jsx)(n.p,{children:"web\u548cadmin"}),"\n",(0,d.jsx)(n.h2,{id:"4\u521b\u5efaservice",children:"4\u3001\u521b\u5efaservice"}),"\n",(0,d.jsx)(n.p,{children:"\u63a5\u53e3\uff1aVideoService.java"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"package com.guli.vod.service;\npublic interface VideoService {\n    String uploadVideo(MultipartFile file);\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5b9e\u73b0\uff1aVideoServiceImpl.java"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'package com.guli.vod.service.impl;\n\n@Service\npublic class VideoServiceImpl implements VideoService {\n\n    @Override\n    public String uploadVideo(MultipartFile file) {\n\n        try {\n            InputStream inputStream = file.getInputStream();\n            String originalFilename = file.getOriginalFilename();\n            String title = originalFilename.substring(0, originalFilename.lastIndexOf("."));\n\n            UploadStreamRequest request = new UploadStreamRequest(\n                    ConstantPropertiesUtil.ACCESS_KEY_ID,\n                    ConstantPropertiesUtil.ACCESS_KEY_SECRET,\n                    title, originalFilename, inputStream);\n\n            UploadVideoImpl uploader = new UploadVideoImpl();\n            UploadStreamResponse response = uploader.uploadStream(request);\n\n            //\u5982\u679c\u8bbe\u7f6e\u56de\u8c03URL\u65e0\u6548\uff0c\u4e0d\u5f71\u54cd\u89c6\u9891\u4e0a\u4f20\uff0c\u53ef\u4ee5\u8fd4\u56deVideoId\u540c\u65f6\u4f1a\u8fd4\u56de\u9519\u8bef\u7801\u3002\n            // \u5176\u4ed6\u60c5\u51b5\u4e0a\u4f20\u5931\u8d25\u65f6\uff0cVideoId\u4e3a\u7a7a\uff0c\u6b64\u65f6\u9700\u8981\u6839\u636e\u8fd4\u56de\u9519\u8bef\u7801\u5206\u6790\u5177\u4f53\u9519\u8bef\u539f\u56e0\n            String videoId = response.getVideoId();\n            if (!response.isSuccess()) {\n                String errorMessage = "\u963f\u91cc\u4e91\u4e0a\u4f20\u9519\u8bef\uff1a" + "code\uff1a" + response.getCode() + ", message\uff1a" + response.getMessage();\n                log.warn(errorMessage);\n                if(StringUtils.isEmpty(videoId)){\n                    throw new GuliException(20001, errorMessage);\n                }\n            }\n\n            return videoId;\n        } catch (IOException e) {\n            throw new GuliException(20001, "guli vod \u670d\u52a1\u4e0a\u4f20\u5931\u8d25");\n        }\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"5\u521b\u5efacontroller",children:"5\u3001\u521b\u5efacontroller"}),"\n",(0,d.jsx)(n.p,{children:"VideoAdminController.java"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'package com.guli.vod.controller.admin;\n\n@Api(description="\u963f\u91cc\u4e91\u89c6\u9891\u70b9\u64ad\u5fae\u670d\u52a1")\n@CrossOrigin //\u8de8\u57df\n@RestController\n@RequestMapping("/admin/vod/video")\npublic class VideoAdminController {\n\n    @Autowired\n    private VideoService videoService;\n\n    @PostMapping("upload")\n    public R uploadVideo(\n            @ApiParam(name = "file", value = "\u6587\u4ef6", required = true)\n            @RequestParam("file") MultipartFile file) throws Exception {\n\n        String videoId = videoService.uploadVideo(file);\n        return R.ok().message("\u89c6\u9891\u4e0a\u4f20\u6210\u529f").data("videoId", videoId);\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"6\u542f\u52a8\u540e\u7aefvod\u5fae\u670d\u52a1",children:"6\u3001\u542f\u52a8\u540e\u7aefvod\u5fae\u670d\u52a1"}),"\n",(0,d.jsx)(n.h2,{id:"7swagger\u6d4b\u8bd5",children:"7\u3001swagger\u6d4b\u8bd5"})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(s,{...e})}):s(e)}}}]);