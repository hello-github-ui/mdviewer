<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-谷粒学院在线教育项目/day16/04-Canal数据同步工具" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">04-Canal数据同步工具 | 我的文档站</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hello-github-ui.github.io/mdviewer/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="04-Canal数据同步工具 | 我的文档站"><meta data-rh="true" name="description" content="1、应用场景"><meta data-rh="true" property="og:description" content="1、应用场景"><link data-rh="true" rel="icon" href="/mdviewer/system/logo.png"><link data-rh="true" rel="canonical" href="https://hello-github-ui.github.io/mdviewer/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具"><link data-rh="true" rel="alternate" href="https://hello-github-ui.github.io/mdviewer/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具" hreflang="en"><link data-rh="true" rel="alternate" href="https://hello-github-ui.github.io/mdviewer/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://USTSQRVOIC-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"04-Canal数据同步工具","item":"https://hello-github-ui.github.io/mdviewer/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="我的文档站" href="/mdviewer/opensearch.xml"><link rel="stylesheet" href="/mdviewer/assets/css/styles.6b1c946f.css">
<script src="/mdviewer/assets/js/runtime~main.abb1c393.js" defer="defer"></script>
<script src="/mdviewer/assets/js/main.e858d5f1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><a class="navbar__brand" href="/mdviewer/"></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><button style="position:fixed;top:75px;left:240px;z-index:1000;width:32px;height:32px;background:#fff;border:1px solid #eee;border-radius:50%;cursor:pointer;transition:left 0.3s;color:green" aria-label="收起侧边栏">&lt;</button><div class="sidebar-expanded" style="height:100%"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/AI/AI">AI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/Docker教程/使用docker-desktop安装AlmaLinux8教程">Docker教程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/Git教程/Git Tutorial">Git教程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/Python基础/虚拟环境/01-搭建虚拟环境">Python基础</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/Vue3入门到实战/TypeScript极速梳理">Vue3入门到实战</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mdviewer/docs/intro">关于本站</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/个人博客/AlmaLinux8安装PostgreSQL">个人博客</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/书签/01-收藏的网站">书签</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mdviewer/docs/油猴脚本开发教程/51CTO网站解除禁止复制">油猴脚本开发教程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/mdviewer/docs/谷粒学院在线教育项目/day01/01-在线教育行业介绍">谷粒学院在线教育项目</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day01/01-在线教育行业介绍">day01</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day02/01-数据库设计">day02</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day03/01-前端开发和前端开发工具">day03</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day04/01-NPM包管理器">day04</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day05/01-项目中的路由">day05</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒  学院在线教育项目/day06/01-阿里云存储OSS">day06</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day07/01-课程发布表单-步骤导航">day07</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day08/01-课程大纲列表显示">day08</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day09/01-课程列表的显示">day09</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day10/01-SpringCloud相关概念介绍">day10</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day11/01-服务端渲染技术NUXT-初始化NUXT">day11</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day12/01-登录业务介绍">day12</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day13/01-OAuth2的使用场景">day13</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day14/01-名师页面静态效果整合">day14</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day15/01-课程支付功能需求描述">day15</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day16/01-统计分析功能（生成统计数据）">day16</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day16/01-统计分析功能（生成统计数据）">01-统计分析功能（生成统计数据）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day16/02-生成统计数据前端整合">02-生成统计数据前端整合</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day16/03-统计数据图表显示">03-统计数据图表显示</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具">04-Canal数据同步工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day16/05-随堂笔记">05-随堂笔记</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day17/01-GATEWAY网关">day17</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day18/01-整合Spring Security">day18</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day19/01-提交代码到远程Git仓库">day19</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/mdviewer/docs/谷粒学院在线教育项目/day20/01-面试总结">day20</a></div></li></ul></li></ul></nav></div></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mdviewer/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">谷粒学院在线教育项目</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">day16</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">04-Canal数据同步工具</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>一、Canal介绍</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1应用场景">1、应用场景<a href="#1应用场景" class="hash-link" aria-label="Direct link to 1、应用场景" title="Direct link to 1、应用场景">​</a></h2>
<p>在前面的统计分析功能中，我们采取了服务调用获取统计数据，这样耦合度高，效率相对较低，目前我采取另一种实现方式，通过实时同步数据库表的方式实现，例如我们要统计每天注册与登录人数，我们只需把会员表同步到统计库中，实现本地统计就可以了，这样效率更高，耦合度更低，Canal就是一个很好的数据库同步工具。canal是阿里巴巴旗下的一款开源项目，纯Java开发。基于数据库增量日志解析，提供增量数据订阅&amp;消费，目前主要支持了MySQL。</p>
<p><strong>2、Canal环境搭建</strong></p>
<p><strong>canal的原理是基于mysql binlog技术，所以这里一定需要开启mysql的binlog写入功能</strong></p>
<p><strong>开启mysql服务：</strong> service mysql start</p>
<p><strong>（1）检查binlog功能是否有开启</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mysql&gt; show variables like &#x27;log_bin&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Variable_name | Value |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| log_bin       | OFF    |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 row in set (0.00 sec)</span><br></span></code></pre></div></div>
<p><strong>（2）如果显示状态为OFF表示该功能未开启，开启binlog功能</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1，修改 mysql 的配置文件 my.cnf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vi /etc/my.cnf </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">追加内容：</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">log-bin=mysql-bin     #binlog文件名</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">binlog_format=ROW     #选择row模式</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">server_id=1           #mysql实例id,不能和canal的slaveId重复</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2，重启 mysql：</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service mysql restart   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3， 登录 mysql 客户端，查看 log_bin 变量</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mysql&gt; show variables like &#x27;log_bin&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Variable_name | Value |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| log_bin       | ON|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------+-------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 row in set (0.00 sec)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">————————————————</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">如果显示状态为ON表示该功能已开启</span><br></span></code></pre></div></div>
<p><strong>（3）在mysql里面添加以下的相关用户和权限</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE USER &#x27;canal&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;canal&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GRANT SHOW VIEW, SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;canal&#x27;@&#x27;%&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FLUSH PRIVILEGES;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3下载安装canal服务">3、下载安装Canal服务<a href="#3下载安装canal服务" class="hash-link" aria-label="Direct link to 3、下载安装Canal服务" title="Direct link to 3、下载安装Canal服务">​</a></h2>
<p>下载地址：</p>
<p><a href="https://github.com/alibaba/canal/releases" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/canal/releases</a></p>
<p><strong>（1）下载之后，放到目录中，解压文件</strong></p>
<p>cd <code>/usr/local/canal</code></p>
<p>canal.deployer-1.1.4.tar.gz</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar zxvf canal.deployer-1.1.4.tar.gz</span><br></span></code></pre></div></div>
<p><strong>（2）修改配置文件</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">vi conf/example/instance.properties</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#需要改成自己的数据库信息</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">canal.instance.master.address=192.168.44.132:3306</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#需要改成自己的数据库用户名与密码</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">canal.instance.dbUsername=canal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">canal.instance.dbPassword=canal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#需要改成同步的数据库表规则，例如只是同步一下表</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#canal.instance.filter.regex=.*\\..*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">canal.instance.filter.regex=guli_ucenter.ucenter_member</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="注">注：<a href="#注" class="hash-link" aria-label="Direct link to 注：" title="Direct link to 注：">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mysql 数据解析关注的表，Perl正则表达式.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">多个正则之间以逗号(,)分隔，转义符需要双斜杠(\\) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">常见例子：</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1.  所有表：.*   or  .*\\..*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2.  canal schema下所有表： canal\\..*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3.  canal下的以canal打头的表：canal\\.canal.*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4.  canal schema下的一张表：canal.test1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5.  多个规则组合使用：canal\\..*,mysql.test1,mysql.test2 (逗号分隔)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">注意：此过滤条件只针对row模式的数据有效(ps. mixed/statement因为不解析sql，所以无法准确提取tableName进行过滤)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>（3）进入bin目录下启动</strong></p>
<p><strong>sh bin/startup.sh</strong></p>
<p><strong>二、创建canal_client模块</strong></p>
<p><strong>1、在guliedu_parent下创建canal_client模块</strong></p>
<p><img alt="img" src="data:image/png;base64,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" width="355" height="228" style="cursor:zoom-in;border-radius:8px;transition:box-shadow 0.2s ease, filter 0.2s ease;image-rendering:auto" title="点击查看大图"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2引入相关依赖">2、引入相关依赖<a href="#2引入相关依赖" class="hash-link" aria-label="Direct link to 2、引入相关依赖" title="Direct link to 2、引入相关依赖">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;!--mysql--&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;groupId&gt;commons-dbutils&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;artifactId&gt;commons-dbutils&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;groupId&gt;com.alibaba.otter&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;artifactId&gt;canal.client&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;/dependencies&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3创建applicationproperties配置文件">3、创建application.properties配置文件<a href="#3创建applicationproperties配置文件" class="hash-link" aria-label="Direct link to 3、创建application.properties配置文件" title="Direct link to 3、创建application.properties配置文件">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 服务端口</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">server.port=10000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 服务名</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spring.application.name=canal-client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 环境设置：dev、test、prod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spring.profiles.active=dev</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># mysql数据库连接</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spring.datasource.url=jdbc:mysql://localhost:3306/guli?serverTimezone=GMT%2B8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spring.datasource.username=root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spring.datasource.password=root</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4编写canal客户端类">4、编写canal客户端类<a href="#4编写canal客户端类" class="hash-link" aria-label="Direct link to 4、编写canal客户端类" title="Direct link to 4、编写canal客户端类">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.alibaba.otter.canal.client.CanalConnector;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.alibaba.otter.canal.client.CanalConnectors;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.alibaba.otter.canal.protocol.CanalEntry.*;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.alibaba.otter.canal.protocol.Message;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.google.protobuf.InvalidProtocolBufferException;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import org.apache.commons.dbutils.DbUtils;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import org.apache.commons.dbutils.QueryRunner;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import javax.annotation.Resource;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import javax.sql.DataSource;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.net.InetSocketAddress;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.sql.Connection;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.sql.SQLException;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.util.Iterator;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.util.Queue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.util.concurrent.ConcurrentLinkedQueue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class CanalClient {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //sql队列</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Queue&lt;String&gt; SQL_QUEUE = new ConcurrentLinkedQueue&lt;&gt;();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private DataSource dataSource;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * canal入库方法</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void run() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        CanalConnector connector = CanalConnectors.newSingleConnector(new InetSocketAddress(&quot;192.168.44.132&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                11111), &quot;example&quot;, &quot;&quot;, &quot;&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        int batchSize = 1000;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            connector.connect();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            connector.subscribe(&quot;.*\\..*&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            connector.rollback();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                while (true) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    //尝试从master那边拉去数据batchSize条记录，有多少取多少</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Message message = connector.getWithoutAck(batchSize);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    long batchId = message.getId();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    int size = message.getEntries().size();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (batchId == -1 || size == 0) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        Thread.sleep(1000);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        dataHandle(message.getEntries());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    connector.ack(batchId);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    //当队列里面堆积的sql大于一定数值的时候就模拟执行</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (SQL_QUEUE.size() &gt;= 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        executeQueueSql();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e.printStackTrace();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            } catch (InvalidProtocolBufferException e) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                e.printStackTrace();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } finally {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            connector.disconnect();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * 模拟执行队列里面的sql语句</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void executeQueueSql() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        int size = SQL_QUEUE.size();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for (int i = 0; i &lt; size; i++) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            String sql = SQL_QUEUE.poll();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            System.out.println(&quot;[sql]----&gt; &quot; + sql);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            this.execute(sql.toString());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * 数据处理</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param entrys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private void dataHandle(List&lt;Entry&gt; entrys) throws InvalidProtocolBufferException {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for (Entry entry : entrys) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (EntryType.ROWDATA == entry.getEntryType()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                EventType eventType = rowChange.getEventType();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                if (eventType == EventType.DELETE) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    saveDeleteSql(entry);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                } else if (eventType == EventType.UPDATE) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    saveUpdateSql(entry);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                } else if (eventType == EventType.INSERT) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    saveInsertSql(entry);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * 保存更新语句</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param entry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private void saveUpdateSql(Entry entry) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            for (RowData rowData : rowDatasList) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                List&lt;Column&gt; newColumnList = rowData.getAfterColumnsList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                StringBuffer sql = new StringBuffer(&quot;update &quot; + entry.getHeader().getTableName() + &quot; set &quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for (int i = 0; i &lt; newColumnList.size(); i++) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sql.append(&quot; &quot; + newColumnList.get(i).getName()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            + &quot; = &#x27;&quot; + newColumnList.get(i).getValue() + &quot;&#x27;&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (i != newColumnList.size() - 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sql.append(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                sql.append(&quot; where &quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                List&lt;Column&gt; oldColumnList = rowData.getBeforeColumnsList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for (Column column : oldColumnList) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (column.getIsKey()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        //暂时只支持单一主键</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sql.append(column.getName() + &quot;=&quot; + column.getValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                SQL_QUEUE.add(sql.toString());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } catch (InvalidProtocolBufferException e) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * 保存删除语句</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param entry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private void saveDeleteSql(Entry entry) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            for (RowData rowData : rowDatasList) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                List&lt;Column&gt; columnList = rowData.getBeforeColumnsList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                StringBuffer sql = new StringBuffer(&quot;delete from &quot; + entry.getHeader().getTableName() + &quot; where &quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for (Column column : columnList) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (column.getIsKey()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        //暂时只支持单一主键</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sql.append(column.getName() + &quot;=&quot; + column.getValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                SQL_QUEUE.add(sql.toString());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } catch (InvalidProtocolBufferException e) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * 保存插入语句</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param entry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private void saveInsertSql(Entry entry) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            RowChange rowChange = RowChange.parseFrom(entry.getStoreValue());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            List&lt;RowData&gt; rowDatasList = rowChange.getRowDatasList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            for (RowData rowData : rowDatasList) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                List&lt;Column&gt; columnList = rowData.getAfterColumnsList();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                StringBuffer sql = new StringBuffer(&quot;insert into &quot; + entry.getHeader().getTableName() + &quot; (&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for (int i = 0; i &lt; columnList.size(); i++) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sql.append(columnList.get(i).getName());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (i != columnList.size() - 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sql.append(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                sql.append(&quot;) VALUES (&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                for (int i = 0; i &lt; columnList.size(); i++) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sql.append(&quot;&#x27;&quot; + columnList.get(i).getValue() + &quot;&#x27;&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    if (i != columnList.size() - 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sql.append(&quot;,&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                sql.append(&quot;)&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                SQL_QUEUE.add(sql.toString());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } catch (InvalidProtocolBufferException e) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * 入库</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     * @param sql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void execute(String sql) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Connection con = null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if(null == sql) return;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            con = dataSource.getConnection();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            QueryRunner qr = new QueryRunner();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            int row = qr.execute(con, sql);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            System.out.println(&quot;update: &quot;+ row);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } catch (SQLException e) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } finally {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            DbUtils.closeQuietly(con);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5创建启动类">5、创建启动类<a href="#5创建启动类" class="hash-link" aria-label="Direct link to 5、创建启动类" title="Direct link to 5、创建启动类">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class CanalApplication implements CommandLineRunner {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private CanalClient canalClient;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        SpringApplication.run(CanalApplication.class, args);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public void run(String... strings) throws Exception {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //项目启动，执行canal客户端监听</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        canalClient.run();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/mdviewer/docs/tags/尚硅谷">尚硅谷</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/hello-github-ui/mdviewer/edit/master/docs/谷粒学院在线教育项目/day16/04-Canal数据同步工具.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mdviewer/docs/谷粒学院在线教育项目/day16/03-统计数据图表显示"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">03-统计数据图表显示</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mdviewer/docs/谷粒学院在线教育项目/day16/05-随堂笔记"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">05-随堂笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1应用场景" class="table-of-contents__link toc-highlight">1、应用场景</a></li><li><a href="#3下载安装canal服务" class="table-of-contents__link toc-highlight">3、下载安装Canal服务</a></li><li><a href="#注" class="table-of-contents__link toc-highlight">注：</a></li><li><a href="#2引入相关依赖" class="table-of-contents__link toc-highlight">2、引入相关依赖</a></li><li><a href="#3创建applicationproperties配置文件" class="table-of-contents__link toc-highlight">3、创建application.properties配置文件</a></li><li><a href="#4编写canal客户端类" class="table-of-contents__link toc-highlight">4、编写canal客户端类</a></li><li><a href="#5创建启动类" class="table-of-contents__link toc-highlight">5、创建启动类</a></li></ul></div></div></div><div class="giscus-comments"><h3>💬 评论区</h3></div></div></main></div></div></div></div>
</body>
</html>