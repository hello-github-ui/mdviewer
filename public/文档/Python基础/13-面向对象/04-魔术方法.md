Python é¢å‘å¯¹è±¡ä¸­çš„å¸¸ç”¨é­”æœ¯æ–¹æ³•ï¼ˆMagic Methodsï¼‰

**é­”æœ¯æ–¹æ³•ï¼ˆMagic Methodsï¼‰** ä¹Ÿå« **ç‰¹æ®Šæ–¹æ³•ï¼ˆDunder Methodsï¼ŒåŒä¸‹åˆ’çº¿æ–¹æ³•ï¼‰**ï¼Œæ˜¯ Python ç±»ä¸­è‡ªå¸¦çš„**ç‰¹æ®Šå‘½åæ–¹æ³•**ï¼Œé€šå¸¸ä»¥ `__xxx__` å½¢å¼å‘½åï¼Œå¦‚ `__init__`ã€`__str__` ç­‰ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è®©å¯¹è±¡**æ›´å…·å¯è¯»æ€§ã€å¯æ“ä½œæ€§**ï¼Œå¹¶ä¸”**æ”¯æŒè¿ç®—ç¬¦é‡è½½**ã€‚

# 1.å¯¹è±¡åˆ›å»ºä¸é”€æ¯

| æ–¹æ³•                  | ä½œç”¨                               |
| --------------------- | ---------------------------------- |
| `__init__(self, ...)` | æ„é€ å‡½æ•°ï¼Œåˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨       |
| `__new__(cls, ...)`   | åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼ˆç”¨äºæ§åˆ¶å®ä¾‹åŒ–è¿‡ç¨‹ï¼‰ |
| `__del__(self)`       | ææ„å‡½æ•°ï¼Œåˆ é™¤å¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨       |

ç¤ºä¾‹ï¼š

```python
class Person:
    def __new__(cls, *args, **kwargs):
        print("è°ƒç”¨ __new__ æ–¹æ³•")
        return super().__new__(cls)  # è¿”å›å®ä¾‹å¯¹è±¡

    def __init__(self, name):
        print("è°ƒç”¨ __init__ æ–¹æ³•")
        self.name = name

    def __del__(self):
        print(f"å¯¹è±¡ {self.name} è¢«é”€æ¯")

p = Person("Alice")  # è°ƒç”¨ __new__ å’Œ __init__
del p  # è§¦å‘ __del__
```

è¾“å‡ºï¼š

```markdown
è°ƒç”¨ __new__ æ–¹æ³•
è°ƒç”¨ __init__ æ–¹æ³•
å¯¹è±¡ Alice è¢«é”€æ¯
```

# 2.å¯¹è±¡å­—ç¬¦ä¸²è¡¨ç¤º

| æ–¹æ³•             | ä½œç”¨                                                         |
| ---------------- | ------------------------------------------------------------ |
| `__str__(self)`  | `print(obj)` æˆ– `str(obj)` æ—¶è°ƒç”¨ï¼Œæä¾› **ç”¨æˆ·å‹å¥½** çš„å­—ç¬¦ä¸²è¡¨ç¤º |
| `__repr__(self)` | `repr(obj)` æˆ–äº¤äº’å¼ç¯å¢ƒè°ƒç”¨ï¼Œæä¾› **å¼€å‘è€…å‹å¥½çš„** å­—ç¬¦ä¸²è¡¨ç¤º |

ç¤ºä¾‹ï¼š

```python
class Car:
    def __init__(self, brand, model):
        self.brand = brand
        self.model = model

    def __str__(self):
        return f"{self.brand} - {self.model}"

    def __repr__(self):
        return f"Car(brand='{self.brand}', model='{self.model}')"

car = Car("Tesla", "Model 3")

print(str(car))  # è°ƒç”¨ __str__
print(repr(car)) # è°ƒç”¨ __repr__
```

è¾“å‡ºï¼š

```markdown
Tesla - Model 3
Car(brand='Tesla', model='Model 3')
```

# 3.ç®—æ•°è¿ç®—ç¬¦é‡è½½

| æ–¹æ³•                        | ä½œç”¨                  |
| --------------------------- | --------------------- |
| `__add__(self, other)`      | `+` è¿ç®—ç¬¦ï¼ˆåŠ æ³•ï¼‰    |
| `__sub__(self, other)`      | `-` è¿ç®—ç¬¦ï¼ˆå‰‘æ³•ï¼‰    |
| `__mul__(self, other)`      | `*` è¿ç®—ç¬¦ï¼ˆä¹˜æ³•ï¼‰    |
| `__truediv__(self, other)`  | `/` è¿ç®—ç¬¦ï¼ˆé™¤æ³•ï¼‰    |
| `__floordiv__(self, other)` | `//` è¿ç®—ç¬¦ï¼ˆæ•´é™¤ï¼‰   |
| `__mod__(self, other)`      | `%` è¿ç®—ç¬¦ï¼ˆå–æ¨¡ï¼‰    |
| `__pow__(self, other)`      | `**` è¿ç®—ç¬¦ï¼ˆå¹‚è¿ç®—ï¼‰ |

ç¤ºä¾‹ï¼š

```python
class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __add__(self, other):
        return Point(self.x + other.x, self.y + other.y)

    def __str__(self):
        return f"({self.x}, {self.y})"


p1 = Point(1, 2)
p2 = Point(3, 4)

print(p1 + p2) # è°ƒç”¨ __add__ï¼Œè¾“å‡ºï¼š(4, 6)
```

# 4.æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½

| æ–¹æ³•                  | ä½œç”¨          |
| --------------------- | ------------- |
| `__eq__(self, other)` | `==` ç­‰äº     |
| `__ne__(self, other)` | `!=` ä¸ç­‰äº   |
| `__lt__(self, other)` | `<` å°äº      |
| `__le__(self, other)` | `<=` å°äºç­‰äº |
| `__gt__(self, other)` | `>` å¤§äº      |
| `__ge__(self, other)` | `>=` å¤§äºç­‰äº |

ç¤ºä¾‹ï¼š

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __lt__(self, other):
        return self.age < other.age


p1 = Person("å¼ ä¸‰", 20)
p2 = Person("æå››", 18)

print(p1 < p2)
# ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„
print(p1.__lt__(p2))
```

è¾“å‡ºï¼š

```
False
False
```

# 5.ç´¢å¼•ä¸åˆ‡ç‰‡

| æ–¹æ³•                              | ä½œç”¨                              |
| --------------------------------- | --------------------------------- |
| `__getitem__(self, index)`        | è·å–ç´¢å¼•å…ƒç´  `obj[index]`         |
| `__setitem__(self, index, value)` | è®¾ç½®ç´¢å¼•å…ƒç´  `obj[index] = value` |
| `__delitem__(self, index)`        | åˆ é™¤ç´¢å¼•å…ƒç´  `del obj[index]`     |

ç¤ºä¾‹ï¼š

```python
class CustomList:
    def __init__(self, items):
        self.items = items

    def __getitem__(self, index):
        return self.items[index]

    def __setitem__(self, index, value):
        self.items[index] = value

    def __delitem__(self, index):
        del self.items[index]

nums = CustomList([1, 2, 3, 4])
print(nums[1])  # è°ƒç”¨ __getitem__ï¼Œè¾“å‡º: 2
nums[1] = 99    # è°ƒç”¨ __setitem__
del nums[2]     # è°ƒç”¨ __delitem__
print(nums.items)  # è¾“å‡º: [1, 99, 4]
```

# 6.è¿­ä»£å™¨åè®®

| æ–¹æ³•             | ä½œç”¨           |
| ---------------- | -------------- |
| `__iter__(self)` | è¿”å›è¿­ä»£å™¨å¯¹è±¡ |
| `__next__(self)` | è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´  |

ç¤ºä¾‹ï¼š

```python
class MyRange:
    def __init__(self, start, end):
        self.current = start
        self.end = end

    def __iter__(self):
        return self  # è¿”å›è‡ªèº«ä½œä¸ºè¿­ä»£å™¨

    def __next__(self):
        if self.current >= self.end:
            raise StopIteration
        val = self.current
        self.current += 1
        return val

nums = MyRange(1, 5)
for num in nums:
    print(num)  # è¾“å‡º: 1 2 3 4
```

# 7.ä¸Šä¸‹æ–‡ç®¡ç†å™¨

| æ–¹æ³•                                             | ä½œç”¨                     |
| ------------------------------------------------ | ------------------------ |
| `__enter__(self)`                                | è¿›å…¥ `with` è¯­å¥å—æ—¶è°ƒç”¨ |
| `__exit__(self, exc_type, exc_value, traceback)` | é€€å‡º `with` è¯­å¥å—æ—¶è°ƒç”¨ |

ç¤ºä¾‹ï¼š

```python
class FileManager:
    def __init__(self, filename):
        self.file = open(filename, "w")

    def __enter__(self):
        return self.file

    def __exit__(self, exc_type, exc_value, traceback):
        self.file.close()

with FileManager("test.txt") as f:
    f.write("Hello, World!")
```

# æ€»ç»“

Python æä¾›äº†ä¸°å¯Œçš„é­”æœ¯æ–¹æ³•ï¼Œä½¿å¯¹è±¡æ›´å¼ºå¤§ã€æ˜“ç”¨ã€‚å¸¸è§çš„æœ‰ï¼š

- **å¯¹è±¡åˆ›å»ºé”€æ¯**ï¼š`__init__`ã€`__del__`
- **å­—ç¬¦ä¸²è¡¨ç¤º**ï¼š`__str__`ã€`__repr__`
- **è¿ç®—ç¬¦é‡è½½**ï¼š`__add__`ã€`__sub__`ã€`__eq__`ã€`__lt_`
- **ç´¢å¼•ä¸è¿­ä»£**ï¼š`__getitem__`ã€`__iter__`
- **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼š`__enter__`ã€`__exit__`

è¿™äº›é­”æœ¯æ–¹æ³•èƒ½è®©ç±»**æ›´åƒ Python å†…ç½®ç±»å‹**ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ ğŸš€